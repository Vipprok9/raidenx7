<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RaidenX7 â€“ Web â†” Telegram</title>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #111111;
      --bubble-me: #0078ff;
      --bubble-bot: #444444;
      --fg-bubble: #ffffff;
      --border: #dcdcdc;
    }
    body.dark {
      --bg: #0f1115;
      --fg: #e7e7e7;
      --bubble-me: #4ea3ff;
      --bubble-bot: #2a2a2a;
      --border: #2b2f36;
    }

    html, body { height: 100%; }
    body { margin: 0; background: var(--bg); color: var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }

    header { display: flex; align-items: center; justify-content: center; position: sticky; top: 0; z-index: 10; height: 52px; background: #222; color: #fff; box-shadow: 0 2px 6px rgba(0,0,0,.1); }
    .toggle { position: absolute; right: 12px; cursor: pointer; user-select: none; }

    .gallery { display: flex; gap: 10px; padding: 12px; overflow-x: auto; border-bottom: 1px solid var(--border); }
    .gallery img { height: 120px; border-radius: 12px; flex: 0 0 auto; object-fit: cover; }

    #chatbox { height: 50vh; min-height: 280px; overflow-y: auto; padding: 12px; }
    ul { list-style: none; margin: 0; padding: 0; }
    li.msg { display: flex; margin: 6px 0; }
    li.me { justify-content: flex-end; }
    li.bot { justify-content: flex-start; }
    .bubble { max-width: 70%; padding: 8px 12px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,.06); }
    li.me .bubble { background: var(--bubble-me); color: var(--fg-bubble); }
    li.bot .bubble { background: var(--bubble-bot); color: var(--fg); }
    small.meta { display: block; font-size: 11px; opacity: .75; margin-top: 4px; }

    form#composer { display: flex; gap: 8px; padding: 12px; border-top: 1px solid var(--border); position: sticky; bottom: 0; background: var(--bg); }
    #message { flex: 1; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: transparent; color: var(--fg); }
    button#sendBtn { padding: 10px 16px; border-radius: 10px; border: 1px solid var(--border); background: #2b7cff; color: white; cursor: pointer; }
    button#sendBtn:disabled { opacity: .6; cursor: not-allowed; }
  </style>
</head>
<body>
  <header>
    <div>RaidenX7 Web â†” Telegram</div>
    <div class="toggle" id="themeToggle" title="Dark/Light">ðŸŒ“</div>
  </header>

  <section class="gallery">
    <img src="assets/img1.jpg" alt="áº¢nh 1" />
    <img src="assets/img2.jpg" alt="áº¢nh 2" />
    <img src="assets/img3.jpg" alt="áº¢nh 3" />
    <img src="assets/img4.jpg" alt="áº¢nh 4" />
  </section>

  <section id="chatbox">
    <ul id="chat"></ul>
  </section>

  <form id="composer" autocomplete="off">
    <input id="message" type="text" placeholder="Nháº­p tin nháº¯n..." />
    <button id="sendBtn" type="submit">Gá»­i</button>
  </form>

  <script>
    const API_BASE = "https://raidenx7-bot.onrender.com";

    const root = document.body;
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => { root.classList.toggle('dark'); });

    const chat = document.getElementById('chat');
    const input = document.getElementById('message');
    const form = document.getElementById('composer');

    const renderedIds = new Set();

    function scrollToBottom() {
      const box = document.getElementById('chatbox');
      box.scrollTop = box.scrollHeight;
    }

    function appendMessage({ id, text, from = 'me', pending = false }) {
      if (id && renderedIds.has(id)) return;
      const li = document.createElement('li');
      li.className = `msg ${from}`;
      li.dataset.id = id || '';
      li.innerHTML = `
        <div class="bubble">
          <span class="text"></span>
          <small class="meta">${pending ? 'Ä‘ang gá»­iâ€¦' : ''}</small>
        </div>`;
      li.querySelector('.text').textContent = text;
      chat.appendChild(li);
      if (id) renderedIds.add(id);
      scrollToBottom();
    }

    function markSent(id) {
      const meta = chat.querySelector(\`li[data-id="\${id}"] small.meta\`);
      if (meta) {
        meta.textContent = 'Ä‘Ã£ gá»­i';
        setTimeout(() => meta.textContent = '', 1200);
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text) return;

      const tempId = 'tmp_' + Date.now();
      appendMessage({ id: tempId, text, from: 'me', pending: true });

      try {
        fetch(\`\${API_BASE}/send\`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        }).then(() => markSent(tempId));
      } catch (_) {
        const meta = chat.querySelector(\`li[data-id="\${tempId}"] small.meta\`);
        if (meta) meta.textContent = 'lá»—i gá»­i';
      }

      input.value = '';
      input.focus();
    });

    async function fetchEvents() {
      try {
        const res = await fetch(\`\${API_BASE}/events\`);
        if (!res.ok) return;
        const data = await res.json();
        if (!Array.isArray(data)) return;
        data.forEach(m => {
          if (!chat.querySelector(\`li[data-id="\${m.id}"]\`)) {
            appendMessage(m);
          }
        });
      } catch {}
    }

    setInterval(fetchEvents, 2000);
    fetchEvents();
  </script>
</body>
</html>
